-- GGCMD v2 — Täysin FE, mobiiliystävällinen & toimii Delta Executorissa

if _G.GGCMDv2Loaded then return end
_G.GGCMDv2Loaded = true

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- Anti-kick
hookmetamethod = hookmetamethod or hookmetamethod
local mt = getrawmetatable(game)
setreadonly(mt, false)
local oldNamecall = mt.__namecall
mt.__namecall = newcclosure(function(self, ...)
	local method = getnamecallmethod()
	if tostring(self) == "Kick" or method == "Kick" then
		return warn("Kick estetty")
	end
	return oldNamecall(self, ...)
end)

-- Pelaajan haku
local function getPlayer(name)
	if not name or name == "me" then return LocalPlayer end
	for _, p in pairs(Players:GetPlayers()) do
		if p.Name:lower():sub(1, #name) == name:lower() then return p end
	end
end

-- Fly
local flying = false
local flyConn
local function toggleFly(state)
	local char = LocalPlayer.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	if state and not flying then
		flying = true
		local bv = Instance.new("BodyVelocity", root)
		bv.Name = "GGCMD_Fly"
		bv.MaxForce = Vector3.new(1, 1, 1) * 1e5
		bv.Velocity = Vector3.zero

		flyConn = RunService.RenderStepped:Connect(function()
			local cam = workspace.CurrentCamera
			local move = Vector3.zero
			if UIS:IsKeyDown(Enum.KeyCode.W) then move += cam.CFrame.LookVector end
			if UIS:IsKeyDown(Enum.KeyCode.S) then move -= cam.CFrame.LookVector end
			if UIS:IsKeyDown(Enum.KeyCode.A) then move -= cam.CFrame.RightVector end
			if UIS:IsKeyDown(Enum.KeyCode.D) then move += cam.CFrame.RightVector end
			if UIS:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0,1,0) end
			if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then move -= Vector3.new(0,1,0) end
			bv.Velocity = move.Magnitude > 0 and move.Unit * 50 or Vector3.zero
		end)
	elseif not state and flying then
		flying = false
		if flyConn then flyConn:Disconnect() end
		local bv = root:FindFirstChild("GGCMD_Fly")
		if bv then bv:Destroy() end
	end
end

-- Kick
local function kickPlayer(targetName)
	local target = getPlayer(targetName)
	if target and workspace:FindFirstChild(target.Name) then
		workspace[target.Name]:Destroy()
	end
end

-- Fling
local flingConn
local function flingPlayer(targetName)
	local target = getPlayer(targetName)
	if not target or not target.Character or not LocalPlayer.Character then return end

	local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
	if not root or not targetRoot then return end

	local originalPos = root.Position
	local bv = Instance.new("BodyAngularVelocity")
	bv.AngularVelocity = Vector3.new(0,999999,0)
	bv.MaxTorque = Vector3.new(999999,999999,999999)
	bv.P = 1250
	bv.Name = "GGCMD_Fling"
	bv.Parent = root

	flingConn = RunService.RenderStepped:Connect(function()
		root.CFrame = targetRoot.CFrame + Vector3.new(0,2,0)
	end)

	wait(2)
	if flingConn then flingConn:Disconnect() end
	bv:Destroy()
	root.CFrame = CFrame.new(originalPos)
end

-- Spam
local spamConn
local function startSpam(text)
	if spamConn then return end
	spamConn = RunService.RenderStepped:Connect(function()
		game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(text, "All")
	end)
end

local function stopSpam()
	if spamConn then spamConn:Disconnect(); spamConn = nil end
end

-- Komennot
LocalPlayer.Chatted:Connect(function(msg)
	local args = msg:split(" ")
	local cmd = args[1]:lower()
	local arg = args[2]

	if cmd == ";fly" then
		toggleFly(true)
	elseif cmd == ";unfly" then
		toggleFly(false)
	elseif cmd == ";kick" and arg then
		kickPlayer(arg)
	elseif cmd == ";fling" and arg then
		flingPlayer(arg)
	elseif cmd == ";spam" and args[2] then
		local t = msg:sub(7)
		startSpam(t)
	elseif cmd == ";unspam" then
		stopSpam()
	elseif cmd == ";cmds" then
		warn("Komennot: ;fly ;unfly ;kick nimi ;fling nimi ;spam teksti ;unspam ;cmds")
	end
end)

warn("GGCMD v2 valmis! Kirjoita ;cmds nähdäksesi komennot.")
