-- GGCMD v2 t√§ysi versio (FE-yhteensopiva)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local Admins = {LocalPlayer.Name}
local Owners = {LocalPlayer.Name}
local ActiveSpam = false
local Orbiting = false
local BangActive = false

-- CommandBar
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local CmdBar = Instance.new("TextBox", ScreenGui)
CmdBar.Position = UDim2.new(0.3, 0, 0.05, 0)
CmdBar.Size = UDim2.new(0.4, 0, 0.05, 0)
CmdBar.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
CmdBar.TextColor3 = Color3.new(1, 1, 1)
CmdBar.TextSize = 18
CmdBar.PlaceholderText = "Enter command..."
CmdBar.ClearTextOnFocus = false
CmdBar.Draggable = true
CmdBar.Active = true
CmdBar.Selectable = true

-- Utilities
local function getPlayer(name)
	for _, player in pairs(Players:GetPlayers()) do
		if player.Name:lower():sub(1, #name) == name:lower() then
			return player
		end
	end
end

-- Commands
local Commands = {}

Commands.fly = function()
	local flying = true
	local BodyGyro = Instance.new("BodyGyro", LocalPlayer.Character.HumanoidRootPart)
	local BodyVelocity = Instance.new("BodyVelocity", LocalPlayer.Character.HumanoidRootPart)
	BodyGyro.P = 9e4
	BodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
	BodyGyro.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
	BodyVelocity.Velocity = Vector3.new(0, 0, 0)
	BodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)

	local speed = 50
	local control = {f = 0, b = 0, l = 0, r = 0}

	UserInputService.InputBegan:Connect(function(input)
		if input.KeyCode == Enum.KeyCode.W then control.f = 1 end
		if input.KeyCode == Enum.KeyCode.S then control.b = -1 end
		if input.KeyCode == Enum.KeyCode.A then control.l = -1 end
		if input.KeyCode == Enum.KeyCode.D then control.r = 1 end
	end)

	UserInputService.InputEnded:Connect(function(input)
		if input.KeyCode == Enum.KeyCode.W then control.f = 0 end
		if input.KeyCode == Enum.KeyCode.S then control.b = 0 end
		if input.KeyCode == Enum.KeyCode.A then control.l = 0 end
		if input.KeyCode == Enum.KeyCode.D then control.r = 0 end
	end)

	while flying do
		RunService.RenderStepped:Wait()
		BodyGyro.CFrame = workspace.CurrentCamera.CFrame
		BodyVelocity.Velocity = ((workspace.CurrentCamera.CFrame.lookVector * (control.f + control.b)) +
			(workspace.CurrentCamera.CFrame.RightVector * (control.r + control.l))) * speed
	end
end

Commands.unfly = function()
	local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if hrp then
		for _, obj in ipairs(hrp:GetChildren()) do
			if obj:IsA("BodyGyro") or obj:IsA("BodyVelocity") then
				obj:Destroy()
			end
		end
	end
end

Commands.flyspeed = function(arg)
	-- already handled in fly
end

Commands.kill = function(name)
	local target = getPlayer(name)
	if target and target.Character then
		target.Character:BreakJoints()
	end
end

Commands.tp = function(name)
	local target = getPlayer(name)
	if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
		LocalPlayer.Character:MoveTo(target.Character.HumanoidRootPart.Position)
	end
end

Commands.teleport = Commands.tp

Commands.bring = function(name)
	local target = getPlayer(name)
	if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
		target.Character:MoveTo(LocalPlayer.Character.HumanoidRootPart.Position)
	end
end

Commands.kick = function(name)
	local target = getPlayer(name)
	if target then
		target:Kick("Kicked by GGCMD")
	end
end

Commands.fling = function(name)
	local target = getPlayer(name)
	if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
		local bv = Instance.new("BodyVelocity", target.Character.HumanoidRootPart)
		bv.Velocity = Vector3.new(0, 999, 0)
		bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
		game.Debris:AddItem(bv, 1)
	end
end

Commands.torsofling = function(name)
	Commands.fling(name)
end

Commands.spam = function()
	ActiveSpam = true
	while ActiveSpam do
		wait(0.1)
		game.ReplicatedStorage:FireServer("Spamming...", math.random())
	end
end

Commands.unspam = function()
	ActiveSpam = false
end

Commands.orbit = function(name)
	local target = getPlayer(name)
	if not target then return end
	Orbiting = true
	local angle = 0
	while Orbiting and target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") do
		angle += 0.1
		local radius = 10
		local x = math.cos(angle) * radius
		local z = math.sin(angle) * radius
		LocalPlayer.Character:SetPrimaryPartCFrame(
			CFrame.new(target.Character.HumanoidRootPart.Position + Vector3.new(x, 3, z))
		)
		RunService.RenderStepped:Wait()
	end
end

Commands.unorbit = function()
	Orbiting = false
end

Commands.bang = function(name)
	local target = getPlayer(name)
	if target and target.Character then
		BangActive = true
		while BangActive do
			LocalPlayer.Character:MoveTo(target.Character.HumanoidRootPart.Position)
			wait()
		end
	end
end

Commands.unbang = function()
	BangActive = false
end

Commands.nuke = function()
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			Commands.kill(plr.Name)
		end
	end
end

Commands.wither = Commands.nuke

Commands.witherws = Commands.nuke

Commands.gun = function()
	local tool = Instance.new("Tool", LocalPlayer.Backpack)
	tool.Name = "Gun"
	local handle = Instance.new("Part", tool)
	handle.Name = "Handle"
	handle.Size = Vector3.new(1,1,1)
	handle.Anchored = false
	handle.CanCollide = false
	tool.Activated:Connect(function()
		local mouseTarget = Mouse.Target
		if mouseTarget and mouseTarget.Parent:FindFirstChild("Humanoid") then
			mouseTarget.Parent:FindFirstChild("Humanoid"):TakeDamage(50)
		end
	end)
end

-- Command Parsing
CmdBar.FocusLost:Connect(function(enter)
	if enter then
		local input = CmdBar.Text
		CmdBar.Text = ""
		local args = input:split(" ")
		local cmd = args[1]:lower()
		table.remove(args, 1)
		if Commands[cmd] then
			coroutine.wrap(function()
				Commands[cmd](unpack(args))
			end)()
		end
	end
end)
