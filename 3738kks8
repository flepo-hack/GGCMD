-- GGCMD v2 by Googlepoika (Fully Updated)

local plr = game.Players.LocalPlayer
local mouse = plr:GetMouse()
local cmdPrefix = ";"
local commands = {}
local orbiting = false
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")

-- Auto GUI
local function autoGUI()
    local gui = Instance.new("ScreenGui", plr:WaitForChild("PlayerGui"))
    gui.Name = "GGCMD_GUI"
    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0, 200, 0, 150)
    frame.Position = UDim2.new(0.5, -100, 0.5, -75)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    frame.BorderSizePixel = 0
    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(1, 0, 1, 0)
    label.TextColor3 = Color3.new(1,1,1)
    label.TextWrapped = true
    label.Text = "GGCMD v2 GUI\nUse chat to enter commands.\nFE & Mobile Ready."
    label.BackgroundTransparency = 1
    task.delay(4, function() gui:Destroy() end)
end
autoGUI()

-- Utility
local function notify(txt)
    game.StarterGui:SetCore("SendNotification", {
        Title = "GGCMD v2",
        Text = txt,
        Duration = 4
    })
end

local function getPlayer(name)
    name = name:lower()
    for _, v in pairs(game.Players:GetPlayers()) do
        if v.Name:lower():sub(1, #name) == name then
            return v
        end
    end
end

-- Commands
commands.fly = function()
    local char = plr.Character
    if not char or char:FindFirstChild("GGCMD_Fly") then return end
    local hrp = char:WaitForChild("HumanoidRootPart")

    local flyFlag = Instance.new("BoolValue", char)
    flyFlag.Name = "GGCMD_Fly"

    local bv = Instance.new("BodyVelocity", hrp)
    bv.Name = "GGCMD_BV"
    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bv.P = 1250
    bv.Velocity = Vector3.zero

    local bg = Instance.new("BodyGyro", hrp)
    bg.Name = "GGCMD_BG"
    bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    bg.P = 3000
    bg.CFrame = hrp.CFrame

    notify("Fly ON (use movement controls)")

    RS:BindToRenderStep("GGCMD_FlyStep", Enum.RenderPriority.Input.Value, function()
        if not char or not char:FindFirstChild("GGCMD_Fly") then
            RS:UnbindFromRenderStep("GGCMD_FlyStep")
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end
            return
        end

        local cam = workspace.CurrentCamera
        local moveVec = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec = moveVec + cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec = moveVec - cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec = moveVec - cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec = moveVec + cam.CFrame.RightVector end
        moveVec = moveVec.Unit * 80
        if moveVec.Magnitude ~= moveVec.Magnitude then moveVec = Vector3.zero end
        bv.Velocity = moveVec
        bg.CFrame = cam.CFrame
    end)
end

commands.unfly = function()
    local char = plr.Character
    if char and char:FindFirstChild("GGCMD_Fly") then
        char:FindFirstChild("GGCMD_Fly"):Destroy()
        RS:UnbindFromRenderStep("GGCMD_FlyStep")
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            local bv = hrp:FindFirstChild("GGCMD_BV")
            local bg = hrp:FindFirstChild("GGCMD_BG")
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end
        end
        notify("Fly OFF")
    end
end

commands.kick = function(args)
    local target = getPlayer(args[1])
    if target then
        pcall(function()
            target:Kick("Banned by GooglepoikaðŸ˜ˆðŸ˜ˆ")
            local name = target.Name
            target:Destroy()
            if game.Players:FindFirstChild(name) then
                game.Players[name]:Destroy()
            end
            if game.Workspace:FindFirstChild(name) then
                game.Workspace[name]:Destroy()
            end
        end)
        notify("Kicked " .. target.Name)
    end
end

commands.fling = function(args)
    local target = getPlayer(args[1])
    if not target or not target.Character then return end
    local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
    local myHRP = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
    if not (targetHRP and myHRP) then return end

    notify("Flinging " .. target.Name)

    local angle = 0
    local conn
    conn = RS.Heartbeat:Connect(function()
        if not targetHRP or not myHRP or not targetHRP.Parent or not myHRP.Parent then
            conn:Disconnect()
            return
        end
        angle = angle + 1
        local offset = CFrame.Angles(0, math.rad(angle * 10), 0) * CFrame.new(5, 0, 0)
        myHRP.CFrame = targetHRP.CFrame * offset
        local bv = Instance.new("BodyVelocity", targetHRP)
        bv.Velocity = Vector3.new(math.random(-9000, 9000), 9999, math.random(-9000, 9000))
        bv.MaxForce = Vector3.new(1e9, 1e9, 1e9)
        game.Debris:AddItem(bv, 0.1)
    end)
    task.delay(2, function() conn:Disconnect() end)
end

local spamLoop = false
commands.spam = function(args)
    local target = getPlayer(args[1])
    if not target then return end
    spamLoop = true
    notify("Spamming " .. target.Name)
    task.spawn(function()
        while spamLoop and target and target.Parent do
            game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("You suck " .. target.Name, "All")
            task.wait(0.3)
        end
    end)
end

commands.unspam = function()
    spamLoop = false
    notify("Spam stopped")
end

commands.cmds = function()
    notify("Commands: ;fly, ;unfly, ;kick [name], ;fling [name], ;spam [name], ;unspam, ;cmds, ;orbit [name], ;unorbit")
end

commands.orbit = function(args)
    local target = getPlayer(args[1])
    if not target or not target.Character then return end
    local center = target.Character:WaitForChild("HumanoidRootPart")
    local myHRP = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
    if not myHRP then return end
    local angle = 0
    local dist = 6
    orbiting = true
    notify("Orbiting " .. target.Name)
    task.spawn(function()
        while orbiting and center and myHRP and center.Parent and myHRP.Parent do
            angle += 0.08
            local x = math.cos(angle) * dist
            local z = math.sin(angle) * dist
            myHRP.CFrame = center.CFrame * CFrame.new(x, 0, z)
            task.wait(0.02)
        end
    end)
end

commands.unorbit = function()
    orbiting = false
    notify("Stopped orbit")
end

-- Chat listener
plr.Chatted:Connect(function(msg)
    if msg:sub(1,1) ~= cmdPrefix then return end
    local split = msg:sub(2):split(" ")
    local cmd = split[1]:lower()
    table.remove(split, 1)
    if commands[cmd] then
        commands[cmd](split)
    else
        notify("Unknown command: " .. cmd)
    end
end)
