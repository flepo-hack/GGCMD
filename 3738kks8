-- GGCMD v2 by Googlepoika (FINAL FIXED)
local plr = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")
local char = plr.Character or plr.CharacterAdded:Wait()
repeat task.wait() until char:FindFirstChild("HumanoidRootPart")

-- Ilmoitus
local function notify(txt)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = "GGCMD v2",
            Text = txt,
            Duration = 4
        })
    end)
end

-- Pelaajahaku
local function getPlayer(name)
    name = name:lower()
    for _, p in pairs(game.Players:GetPlayers()) do
        if p.Name:lower():sub(1, #name) == name then
            return p
        end
    end
end

-- Komennot
local commands = {}

-- FLY (kameraan perustuva liike)
local flyConn
commands.fly = function()
    if char:FindFirstChild("GGCMD_Fly") then return notify("Already flying.") end

    local hrp = char:WaitForChild("HumanoidRootPart")
    Instance.new("BoolValue", char).Name = "GGCMD_Fly"

    local bv = Instance.new("BodyVelocity")
    bv.Name = "GGCMD_BV"
    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bv.Velocity = Vector3.zero
    bv.P = 1250
    bv.Parent = hrp

    local bg = Instance.new("BodyGyro")
    bg.Name = "GGCMD_BG"
    bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    bg.P = 3000
    bg.CFrame = hrp.CFrame
    bg.Parent = hrp

    notify("Fly ON (WASD + E/Q + kamera)")

    flyConn = RS.RenderStepped:Connect(function()
        if not char or not char:FindFirstChild("GGCMD_Fly") then
            if flyConn then flyConn:Disconnect() end
            bv:Destroy()
            bg:Destroy()
            return
        end

        local cam = workspace.CurrentCamera
        local moveDir = Vector3.zero

        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir += cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir -= cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.E) then moveDir += Vector3.new(0, 1, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.Q) then moveDir -= Vector3.new(0, 1, 0) end

        if moveDir.Magnitude > 0 then
            bv.Velocity = moveDir.Unit * 80
        else
            bv.Velocity = Vector3.zero
        end

        bg.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.CFrame.LookVector)
    end)
end

commands.unfly = function()
    if char:FindFirstChild("GGCMD_Fly") then
        char.GGCMD_Fly:Destroy()
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            local bv = hrp:FindFirstChild("GGCMD_BV")
            local bg = hrp:FindFirstChild("GGCMD_BG")
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end
        end
        if flyConn then flyConn:Disconnect() flyConn = nil end
        notify("Fly OFF")
    end
end

-- KICK
commands.kick = function(args)
    local target = getPlayer(args[1])
    if not target then return notify("Player not found.") end

    notify("Kicking "..target.Name)

    pcall(function()
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("Beware of GGCMD", "All")
    end)

    pcall(function()
        target:Kick("Banned by Googlepoika")
    end)
end

-- FLING
commands.fling = function(args)
    local target = getPlayer(args[1])
    if not target or not target.Character then return notify("Player not found.") end

    local root = char:FindFirstChild("HumanoidRootPart")
    local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
    if not root or not targetRoot then return end

    notify("Flinging "..target.Name)
    root.CFrame = targetRoot.CFrame + Vector3.new(0, 3, 0)

    local bav = Instance.new("BodyAngularVelocity", root)
    bav.AngularVelocity = Vector3.new(0, 99999, 0)
    bav.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
    task.wait(1.5)
    bav:Destroy()
end

-- SPAM
local spamConn
commands.spam = function(args)
    if spamConn then spamConn:Disconnect() end
    local text = table.concat(args, " ")
    spamConn = RS.RenderStepped:Connect(function()
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(text, "All")
    end)
    notify("Spam ON")
end

commands.unspam = function()
    if spamConn then
        spamConn:Disconnect()
        notify("Spam OFF")
    end
end

-- CMD LIST
commands.cmds = function()
    notify(";fly ;unfly ;kick ;fling ;spam ;unspam ;gui ;orbit ;unorbit")
end

-- GUI
commands.gui = function()
    notify("GUI opened.")
end

-- ORBIT
local orbitConn
commands.orbit = function(args)
    local target = getPlayer(args[1])
    if not target or not target.Character then return notify("Player not found.") end

    local root = char:FindFirstChild("HumanoidRootPart")
    local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
    if not root or not targetRoot then return end

    notify("Orbiting "..target.Name)
    local angle = 0
    orbitConn = RS.RenderStepped:Connect(function()
        if not targetRoot or not targetRoot.Parent then orbitConn:Disconnect() return end
        angle += 0.2
        local radius = 5
        local offset = Vector3.new(math.cos(angle)*radius, 0, math.sin(angle)*radius)
        root.CFrame = CFrame.new(targetRoot.Position + offset)
    end)
end

commands.unorbit = function()
    if orbitConn then
        orbitConn:Disconnect()
        notify("Orbit OFF")
    end
end

-- CHAT-KOMENNOT
plr.Chatted:Connect(function(msg)
    if msg:sub(1,1) == ";" then
        local split = msg:sub(2):split(" ")
        local cmd = split[1]:lower()
        table.remove(split, 1)
        if commands[cmd] then
            commands[cmd](split)
        end
    end
end)

-- GUI + DISCORD + CMDBAR
local function showGUI()
    notify("GGCMD v2 loaded.")
end
showGUI()

local dsgui = Instance.new("ScreenGui", plr:WaitForChild("PlayerGui"))
dsgui.Name = "GGCMD_Discord"

local text = Instance.new("TextBox", dsgui)
text.Size = UDim2.new(0.4, 0, 0.05, 0)
text.Position = UDim2.new(0.3, 0, 0.02, 0)
text.BackgroundTransparency = 0.3
text.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
text.TextColor3 = Color3.new(1, 1, 1)
text.TextScaled = true
text.Text = "https://discord.gg/nVhG6DDN"
text.ClearTextOnFocus = false
text.TextEditable = false
text.Font = Enum.Font.SourceSansBold

-- CMD BAR GUI
local cmdGui = Instance.new("ScreenGui", plr.PlayerGui)
cmdGui.Name = "GGCMD_CmdBar"

local main = Instance.new("Frame", cmdGui)
main.Size = UDim2.new(0.5, 0, 0.05, 0)
main.Position = UDim2.new(0.25, 0, 0.09, 0)
main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
main.BackgroundTransparency = 0.2
main.Active = true
main.Draggable = true
main.BorderSizePixel = 0
main.ClipsDescendants = true

local textLabel = Instance.new("TextLabel", main)
textLabel.Size = UDim2.new(10, 0, 1, 0)
textLabel.Position = UDim2.new(0, 0, 0, 0)
textLabel.TextColor3 = Color3.new(1, 1, 1)
textLabel.BackgroundTransparency = 1
textLabel.TextScaled = true
textLabel.Font = Enum.Font.SourceSansBold
textLabel.TextXAlignment = Enum.TextXAlignment.Left
textLabel.Text = ";fly ;unfly ;kick ;fling ;spam ;unspam ;gui ;orbit ;unorbit   "

-- Scroll loop
coroutine.wrap(function()
    local pos = 0
    while true do
        task.wait(0.02)
        pos = pos - 2
        if math.abs(pos) > textLabel.TextBounds.X then
            pos = main.AbsoluteSize.X
        end
        textLabel.Position = UDim2.new(0, pos, 0, 0)
    end
end)()

-- Näytä komentolista hetken päästä
task.delay(7, function()
    dsgui:Destroy()
    commands.cmds()
end)
