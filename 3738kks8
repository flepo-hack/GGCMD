--[[
    GGCMD v2 by Googlepoika
    Fully mobile & FE
    Commands: ;fly, ;unfly, ;kick, ;fling, ;spam, ;unspam, ;cmds, ;gui, ;orbit
]]

local plr = game.Players.LocalPlayer
local mouse = plr:GetMouse()
local cmdPrefix = ";"
local commands = {}

local function notify(txt)
    game.StarterGui:SetCore("SendNotification", {
        Title = "GGCMD v2",
        Text = txt,
        Duration = 4
    })
end

-- Helper functions
local function getPlayer(name)
    name = name:lower()
    for _, v in pairs(game.Players:GetPlayers()) do
        if v.Name:lower():sub(1, #name) == name then
            return v
        end
    end
end

-- Command functions
commands.fly = function()
    local char = plr.Character
    if not char then return end
    local hrp = char:WaitForChild("HumanoidRootPart")
    local bv = Instance.new("BodyVelocity")
    bv.Name = "GGCMD_Fly"
    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bv.Velocity = Vector3.zero
    bv.Parent = hrp

    local flying = true
    notify("Fly ON (WASD or thumbstick to move)")
    local conn = game:GetService("RunService").RenderStepped:Connect(function()
        if not flying or not bv or not hrp then return end
        local cam = workspace.CurrentCamera
        local dir = Vector3.zero
        if plr.Character:FindFirstChildOfClass("Humanoid").MoveDirection.Magnitude > 0 then
            dir = cam.CFrame:VectorToWorldSpace(plr.Character:FindFirstChildOfClass("Humanoid").MoveDirection) * 70
        end
        bv.Velocity = dir
    end)

    mouse.KeyDown:Connect(function(k)
        if k == "e" then
            flying = false
            bv:Destroy()
            conn:Disconnect()
            notify("Fly OFF")
        end
    end)
end

commands.unfly = function()
    local char = plr.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local bv = char.HumanoidRootPart:FindFirstChild("GGCMD_Fly")
        if bv then
            bv:Destroy()
            notify("Fly OFF")
        end
    end
end

commands.kick = function(args)
    local target = getPlayer(args[1])
    if target then
        target:Kick("Banned by GooglepoikaðŸ˜ˆðŸ˜ˆ")
    end
end

commands.fling = function(args)
    local target = getPlayer(args[1])
    if not target then return end
    local chr = plr.Character
    local targetHRP = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
    if chr and targetHRP then
        local bv = Instance.new("BodyVelocity", targetHRP)
        bv.Velocity = Vector3.new(9999,9999,9999)
        bv.MaxForce = Vector3.new(1e5,1e5,1e5)
        game.Debris:AddItem(bv, 0.2)
        notify("Flinged " .. target.Name)
    end
end

local spamLoop
commands.spam = function(args)
    local target = getPlayer(args[1])
    if not target then return end
    spamLoop = true
    task.spawn(function()
        while spamLoop and target and target.Parent do
            game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("You suck "..target.Name, "All")
            task.wait(0.3)
        end
    end)
    notify("Spamming " .. target.Name)
end

commands.unspam = function()
    spamLoop = false
    notify("Spam stopped")
end

commands.cmds = function()
    notify("Commands: ;fly, ;unfly, ;kick [name], ;fling [name], ;spam [name], ;unspam, ;cmds, ;gui, ;orbit [name]")
end

commands.gui = function()
    local s = Instance.new("ScreenGui", plr:WaitForChild("PlayerGui"))
    s.Name = "GGCMD_GUI"
    local f = Instance.new("Frame", s)
    f.Size = UDim2.new(0, 200, 0, 150)
    f.Position = UDim2.new(0.5, -100, 0.5, -75)
    f.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    f.BorderSizePixel = 0
    local txt = Instance.new("TextLabel", f)
    txt.Size = UDim2.new(1, 0, 1, 0)
    txt.TextColor3 = Color3.new(1,1,1)
    txt.TextWrapped = true
    txt.Text = "GGCMD v2 GUI\nUse chat to enter commands.\nFE & Mobile Ready."
    txt.BackgroundTransparency = 1
end

commands.orbit = function(args)
    local target = getPlayer(args[1])
    if not target or not target.Character then return end
    local center = target.Character:WaitForChild("HumanoidRootPart")
    local myHRP = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
    if not myHRP then return end
    local angle = 0
    local dist = 5
    local orbiting = true
    notify("Orbiting " .. target.Name)
    task.spawn(function()
        while orbiting and center.Parent and myHRP.Parent do
            angle = angle + 0.05
            local x = math.cos(angle) * dist
            local z = math.sin(angle) * dist
            myHRP.CFrame = center.CFrame * CFrame.new(x, 0, z)
            task.wait(0.03)
        end
    end)
end

-- Chat listener
plr.Chatted:Connect(function(msg)
    if msg:sub(1,1) ~= cmdPrefix then return end
    local split = msg:sub(2):split(" ")
    local cmd = split[1]:lower()
    table.remove(split, 1)
    if commands[cmd] then
        commands[cmd](split)
    else
        notify("Unknown command: " .. cmd)
    end
end)
