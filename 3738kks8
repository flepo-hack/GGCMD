-- GGCMD v2 by Googlepoika

local plr = game.Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local mouse = plr:GetMouse()
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")

-- Notifikaatiot
local function notify(txt)
    game.StarterGui:SetCore("SendNotification", {
        Title = "GGCMD v2",
        Text = txt,
        Duration = 4
    })
end

-- Pelaajahaku
local function getPlayer(name)
    name = name:lower()
    for _, p in pairs(game.Players:GetPlayers()) do
        if p.Name:lower():sub(1, #name) == name then
            return p
        end
    end
end

-- Komennot
local commands = {}

local flyConn
commands.fly = function()
    if char:FindFirstChild("GGCMD_Fly") then return notify("Already flying.") end
    local hrp = char:WaitForChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    Instance.new("BoolValue", char).Name = "GGCMD_Fly"

    local bv = Instance.new("BodyVelocity")
    bv.Name = "GGCMD_BV"
    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bv.Velocity = Vector3.zero
    bv.P = 1250
    bv.Parent = hrp

    local bg = Instance.new("BodyGyro")
    bg.Name = "GGCMD_BG"
    bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    bg.P = 3000
    bg.CFrame = hrp.CFrame
    bg.Parent = hrp

    notify("Fly ON (WASD + E/Q + kamera)")

    flyConn = RS.RenderStepped:Connect(function()
        if not char:FindFirstChild("GGCMD_Fly") then
            flyConn:Disconnect()
            bv:Destroy()
            bg:Destroy()
            return
        end

        local cam = workspace.CurrentCamera
        local moveDir = Vector3.new()
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + Vector3.new(0, 0, -1) end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir + Vector3.new(0, 0, 1) end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir + Vector3.new(-1, 0, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + Vector3.new(1, 0, 0) end

        local camCF = cam.CFrame
        local moveVector = camCF:VectorToWorldSpace(moveDir)
        if moveDir.Magnitude == 0 then moveVector = Vector3.zero end

        local vertical = 0
        if UIS:IsKeyDown(Enum.KeyCode.E) then vertical += 1 end
        if UIS:IsKeyDown(Enum.KeyCode.Q) then vertical -= 1 end

        bv.Velocity = moveVector.Unit * 80 + Vector3.new(0, vertical * 80, 0)
        bg.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.CFrame.LookVector)
    end)
end

commands.unfly = function()
    if char:FindFirstChild("GGCMD_Fly") then
        char:FindFirstChild("GGCMD_Fly"):Destroy()
        notify("Fly OFF")
    end
end

commands.kick = function(args)
    local target = getPlayer(args[1])
    if target then
        notify("Kicking")
        pcall(function()
            target:Kick("Beware of GGCMDðŸ˜ˆðŸ˜ˆ")
            local areas = {
                game.Players,
                game:GetService("Workspace"),
                game:GetService("Workspace"):FindFirstChild("Players"),
                game:GetService("ReplicatedStorage"),
                game:GetService("Lighting")
            }
            for _, parent in pairs(areas) do
                if parent and parent:FindFirstChild(target.Name) then
                    parent[target.Name]:Destroy()
                end
            end
        end)
    end
end

commands.fling = function(args)
    local target = getPlayer(args[1])
    if not target then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local targetRoot = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
    if root and targetRoot then
        notify("Flinging "..target.Name)
        root.CFrame = targetRoot.CFrame + Vector3.new(0,3,0)
        local bv = Instance.new("BodyAngularVelocity", root)
        bv.AngularVelocity = Vector3.new(99999,99999,99999)
        bv.MaxTorque = Vector3.new(1e9,1e9,1e9)
        task.wait(1.5)
        bv:Destroy()
    end
end

local spamConn
commands.spam = function(args)
    local txt = table.concat(args, " ")
    if spamConn then spamConn:Disconnect() end
    spamConn = RS.RenderStepped:Connect(function()
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(txt, "All")
    end)
    notify("Spam ON")
end

commands.unspam = function()
    if spamConn then
        spamConn:Disconnect()
        notify("Spam OFF")
    end
end

commands.cmds = function()
    notify(";fly ;unfly ;kick ;fling ;spam ;unspam ;gui ;orbit ;unorbit")
end

commands.gui = function()
    notify("GUI opened.")
end

local orbitConn
commands.orbit = function(args)
    local target = getPlayer(args[1])
    if not target then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local targetRoot = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
    if root and targetRoot then
        notify("Orbiting "..target.Name)
        local angle = 0
        orbitConn = RS.RenderStepped:Connect(function()
            if not targetRoot or not targetRoot.Parent then
                orbitConn:Disconnect()
                return
            end
            angle += 0.2
            local radius = 5
            root.CFrame = CFrame.new(targetRoot.Position + Vector3.new(math.cos(angle)*radius, 0, math.sin(angle)*radius))
        end)
    end
end

commands.unorbit = function()
    if orbitConn then
        orbitConn:Disconnect()
        notify("Orbit OFF")
    end
end

-- Chatti
plr.Chatted:Connect(function(msg)
    if msg:sub(1,1) == ";" then
        local split = msg:sub(2):split(" ")
        local cmd = split[1]:lower()
        table.remove(split, 1)
        if commands[cmd] then
            commands[cmd](split)
        end
    end
end)

-- GUI automaattisesti nÃ¤kyviin alussa
local function showGUI()
    notify("GGCMD v2 loaded.")
end
showGUI()
task.delay(4, function()
    -- Piilotus vaikka ei GUI-elementtiÃ¤ kÃ¤ytÃ¶ssÃ¤
end)

-- Discord GUI
local dsgui = Instance.new("ScreenGui", plr:WaitForChild("PlayerGui"))
dsgui.Name = "GGCMD_Discord"
local text = Instance.new("TextLabel", dsgui)
text.Size = UDim2.new(0.4,0,0.05,0)
text.Position = UDim2.new(0.3,0,0.02,0)
text.BackgroundTransparency = 0.3
text.BackgroundColor3 = Color3.fromRGB(30,30,30)
text.TextColor3 = Color3.new(1,1,1)
text.TextScaled = true
text.Text = "GGCMD v2 - Discord: https://discord.gg/nVhG6DDN"

task.delay(7, function()
    dsgui:Destroy()
    commands.cmds()
end)
